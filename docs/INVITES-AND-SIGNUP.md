# Invites and signup flow

Private access is enforced through single-use (or limited-use) invite codes. This document explains how to manage invites and how registration consumes them.

## Schema

- `invites` table keeps:
  - `code` – unique token generated by staff.
  - `inviter_user_id` – optional owner (nullable for system invites).
  - `max_uses` / `uses` – enforces the remaining capacity.
  - `expires_at` – optional expiry timestamp.
  - `notes` – free-form context for staff.
- `users.invited_by_id` points back to the inviter.

## Registration

1. `/register` is available to guests and renders `resources/views/auth/register.blade.php`.
2. Users **must** provide an `invite_code` outside the local environment.
3. During registration the code is validated:
   - must exist,
   - must not be expired (`expires_at` in the past),
   - must have remaining uses.
4. The invite `uses` counter increments on success and `users.invited_by_id` is set to the inviter.
5. New members are logged in immediately and redirected to `/`.

## Staff workflow

- Moderators/Admins (role level ≥ 8) can visit `/admin/invites` to list and create invites.
- The panel lets staff set `max_uses`, optional `expires_at`, and notes. Codes are generated server-side.
- Endpoint lives in `InviteAdminController` with routes defined in `routes/web.php`.

## Member insights

- Authenticated users can browse the invites they have sent via `/account/invites` (HTML table rendered from `AccountInviteController`).
- Each row shows code, usage, expiry, and a computed status chip so members know whether a code is still usable.

## Testing

- `tests/Unit/InviteTest.php` verifies the helper methods.
- `tests/Feature/Auth/RegistrationInviteTest.php` exercises the signup validation and usage increments.
- `tests/Feature/Admin/InviteAdminControllerTest.php` ensures the staff interface is locked down.
